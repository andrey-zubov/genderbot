<script type="text/javascript">
    $(document).ready(function f1() {
        setTimeout(foo, 3000);

        var bot_p = $("#bot_text").clone().removeAttr('hidden');
        var us_t = $("#user_text").clone().removeAttr('hidden');
        var btn_s = $("#btn_select").clone().removeAttr('hidden');
        var btn_length = 0;

        $("#btn_send").on("click", foo);

        function foo() {
            var bot_p_new = bot_p.clone();
            var user_t_new = us_t.clone();
            var btn_s_new = btn_s.clone();

            var us_in = $("#user_input").val();
            if (us_in === '') {
                if ($(this).text().length < 50) {
                    {#//because Auto start with $(foo) collect all JS+Html code on $(this).text()#}
                    {#//and send it to the Chat!#}
                    {#//if -> max length on a text button (UserInput in DB)#}
                    us_in = $(this).text()
                }
            }
            {#//console.log(us_in);#}
            $("#chat_div").append(user_t_new.text(us_in));
            $.ajax({
                'url':{% url 'chat_test' %},
                'data': {'us_in': us_in},
                success: function (data) {
                    {#//console.log(data);#}
                    var json_data = jQuery.parseJSON(data);
                    {#//console.log("json_data: ", json_data);#}
                    for (var r = 0; r < btn_length; r++) {
                        {#// remove all old buttons#}
                        $("#id_new_btn").remove();
                    }
                    btn_length = json_data.btn_text.length;

                    $("#user_input").val('');
                    $("#chat_div").append(bot_p_new.html(json_data.help_text));

                    for (var i = 0; i < btn_length; i++) {
                        var btn_clone = btn_s_new.clone();
                        btn_clone.attr('id', 'id_new_btn').on("click", foo);
                        $("#div_add_btn").append(btn_clone.text(json_data.btn_text[i]));
                    }
                }
            });
        }
        $("#btn_hide_chat").on("click", function () {
            $("#chat_show_hide").hide();
            $("#div_add_btn").hide();
        });
        $("#btn_open_chat").on("click", function () {
            $("#chat_show_hide").show();
            $("#div_add_btn").show();
        });
    });
    {#//auto scroll to the bottom of the chat div#}
    window.setInterval(function () {
        var elem = document.getElementById("chat_div");
        elem.scrollTop = elem.scrollHeight;
    }, 1000);
</script>

<p>
    <button id="btn_open_chat"
            class="btn btn-outline-success m-sm-1">
        Chat Bot can help you!
    </button>
    <button id="btn_consultant"
            class="btn btn-outline-info m-sm-1">
        Связаться с консультантом
    </button>
    <button id="btn_hide_chat"
            class="btn btn-outline-danger m-sm-1">x
    </button>
</p>

{#<form method="post">#}
{#{% csrf_token %}#}
<div id="chat_show_hide">
    <div id="chat_div"
         class="py-1 d-inline-flex flex-column rounded"
         style="background-color: #F5F5F5; overflow: scroll; max-height: 400px">
        <p hidden id="bot_text" class="text-left alert alert-dark text-wrap shadow-sm rounded"></p>
{#        <div hidden id="bot_text" class="text-left alert alert-dark text-wrap shadow-sm rounded"></div>#}
        <p hidden id="user_text"
           class="text-right alert alert-success text-wrap shadow-sm rounded"></p>
    </div>
</div>

<div id="div_add_btn" class="my-2">
    <button hidden id="btn_select" type="button"
            class="btn btn-outline-primary m-sm-1"></button>
</div>

<div class="my-2">
    <label for="user_input">Send msg</label>
    <input id="user_input" type="text">

    <button type="button" id="btn_send"
            class="btn btn-outline-success m-sm-1">
        Send
    </button>
</div>
{#</form>#}
